!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-stripe",["exports","@angular/common","@angular/core","rxjs","rxjs/operators"],t):t(e["ngx-stripe"]={},e.ng.common,e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,n,t,a,s){"use strict";var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}var r=(u.prototype.getNativeWindow=function(){return n.isPlatformBrowser(this.platformId)?window:{}},u.decorators=[{type:t.Injectable}],u.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},u);function u(e){this.platformId=e}var p=(c.prototype.getNativeDocument=function(){return n.isPlatformBrowser(this.platformId)?document:{}},c.decorators=[{type:t.Injectable}],c.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},c);function c(e){this.platformId=e}var f=(d.prototype.asStream=function(){return this.load(),this.status.asObservable()},d.prototype.isReady=function(){return this.status.getValue().loaded},d.prototype.load=function(){var e=this;if(!n.isPlatformServer(this.platformId)){var t=this.status.getValue();if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!t.loaded&&!t.loading){this.status.next(o({},t,{loading:!0}));var r=this.document.getNativeDocument().createElement("script");r.type="text/javascript",r.async=!0,r.defer=!0,r.src="https://js.stripe.com/v3/",r.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},r.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(r)}}},d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:r},{type:p}]},d);function d(e,t,r){this.platformId=e,this.window=t,this.document=r,this.status=new a.BehaviorSubject({error:!1,loaded:!1,loading:!1})}var l=new t.InjectionToken("Stripe Publishable Key"),y=new t.InjectionToken("Stripe Options");function h(e){return"type"in e}function m(e){return"bank_account"===e}function v(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type||e.account_holder_type===undefined)}function b(e){return"pii"===e}function g(e){return"personal_id_number"in e}var w=(S.prototype.getInstance=function(){return this.stripe$.getValue()},S.prototype.elements=function(t){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.map(function(e){return e.elements(t)}),s.first())},S.prototype.createToken=function(o,i){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return function r(e){return"account"===e}(o)&&function n(e){return e.legal_entity||e.tos_shown_and_accepted}(i)||m(o)&&v(i)||b(o)&&g(i),a.from(t.createToken(o,i))}),s.first())},S.prototype.createSource=function(r,n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return h(r)?a.from(t.createSource(r)):a.from(t.createSource(r,n))}),s.first())},S.prototype.retrieveSource=function(r){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.retrieveSource(r))}),s.first())},S.prototype.paymentRequest=function(e){var t=this.getInstance();return t?t.paymentRequest(e):undefined},S.prototype.handleCardPayment=function(n,o,i){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return function r(e){return"type"in e}(o)?a.from(t.handleCardPayment(n,o)):a.from(t.handleCardPayment(n,o,i))}))},S.prototype.handleCardAction=function(r){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.handleCardAction(r))}))},S.prototype.confirmPaymentIntent=function(r,n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.confirmPaymentIntent(r,n))}))},S.prototype.createPaymentMethod=function(r,n,o){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return a.from(t.createPaymentMethod(r,n,o))}),s.first())},S.prototype.handleCardSetup=function(n,o,i){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return function r(e){return e&&"type"in e}(i)?a.from(t.handleCardSetup(n,o,i)):a.from(t.handleCardSetup(n,o))}))},S);function S(e,t,r,n){var o=this;this.loader=e,this.window=t,this.key=r,this.options=n,this.stripe$=new a.BehaviorSubject(undefined),this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.first(),s.map(function(){return o.window.getNativeWindow().Stripe})).subscribe(function(e){var t=o.options?e(o.key,o.options):e(o.key);o.stripe$.next(t)})}var I=(P.prototype.getStripeReference=function(){var e=this;return this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.map(function(){return e.window.getNativeWindow().Stripe}))},P.prototype.getInstance=function(){return this.stripe.getInstance()},P.prototype.setKey=function(e,t){return this.changeKey(e,t)},P.prototype.changeKey=function(e,t){return this.stripe=new w(this.loader,this.window,e,t),this.stripe},P.prototype.elements=function(e){return this.stripe.elements(e)},P.prototype.createToken=function(e,t){return this.stripe.createToken(e,t)},P.prototype.createSource=function(e,t){return this.stripe.createSource(e,t)},P.prototype.retrieveSource=function(e){return this.stripe.retrieveSource(e)},P.prototype.paymentRequest=function(e){return this.stripe.paymentRequest(e)},P.prototype.handleCardPayment=function(e,t,r){return this.stripe.handleCardPayment(e,t,r)},P.prototype.handleCardAction=function(e){return this.stripe.handleCardAction(e)},P.prototype.createPaymentMethod=function(e,t,r){return this.stripe.createPaymentMethod(e,t,r)},P.prototype.confirmPaymentIntent=function(e,t){return this.stripe.confirmPaymentIntent(e,t)},P.prototype.handleCardSetup=function(e,t,r){return this.stripe.handleCardSetup(e,t,r)},P.decorators=[{type:t.Injectable}],P.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[l]}]},{type:undefined,decorators:[{type:t.Inject,args:[y]}]},{type:f},{type:r}]},P);function P(e,t,r,n){this.key=e,this.options=t,this.loader=r,this.window=n,e&&(this.stripe=new w(this.loader,this.window,e,t))}var O=(j.prototype.create=function(e,t){return new w(this.loader,this.window,e,t)},j.decorators=[{type:t.Injectable}],j.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[l]}]},{type:String,decorators:[{type:t.Inject,args:[y]}]},{type:f},{type:r}]},j);function j(e,t,r,n){this.baseKey=e,this.baseOptions=t,this.loader=r,this.window=n}var C=(Object.defineProperty(x.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"stripe",{set:function(e){this.stripe$.next(e)},enumerable:!0,configurable:!0}),x.prototype.ngOnInit=function(){var o=this,e=a.combineLatest(this.elementsOptions$.asObservable(),this.stripe$.asObservable()).pipe(s.switchMap(function(e){var t=i(e,2),r=t[0],n=t[1];return n?0<Object.keys(r).length?n.elements(r):n.elements():0<Object.keys(r).length?o.stripeService.elements(r):o.stripeService.elements()}));a.combineLatest(e,this.options$.asObservable().pipe(s.filter(function(e){return Boolean(e)}))).subscribe(function(e){var t=i(e,2),r=t[0],n=t[1];o.element=r.create("card",n),o.element.on("blur",function(e){return o.on.emit({event:e,type:"blur"})}),o.element.on("change",function(e){return o.on.emit({event:e,type:"change"})}),o.element.on("click",function(e){return o.on.emit({event:e,type:"click"})}),o.element.on("focus",function(e){return o.on.emit({event:e,type:"focus"})}),o.element.on("ready",function(e){return o.on.emit({event:e,type:"ready"})}),o.element.mount(o.stripeCard.nativeElement),o.card.emit(o.element)})},x.prototype.getCard=function(){return this.element},x.decorators=[{type:t.Component,args:[{selector:"ngx-stripe-card",template:'\n    <div class="field" #stripeCard></div>\n  '}]}],x.ctorParameters=function(){return[{type:I}]},x.propDecorators={card:[{type:t.Output}],on:[{type:t.Output}],stripeCard:[{type:t.ViewChild,args:["stripeCard"]}],options:[{type:t.Input}],elementsOptions:[{type:t.Input}],stripe:[{type:t.Input}]},x);function x(e){this.stripeService=e,this.card=new t.EventEmitter,this.on=new t.EventEmitter,this.options$=new a.BehaviorSubject({}),this.elementsOptions$=new a.BehaviorSubject({}),this.stripe$=new a.BehaviorSubject(null)}var _=(B.forRoot=function(e,t){return{ngModule:B,providers:[f,I,O,r,p,{provide:l,useValue:e},{provide:y,useValue:t}]}},B.forChild=function(e,t){return{ngModule:B,providers:[f,I,O,r,p,{provide:l,useValue:e},{provide:y,useValue:t}]}},B.decorators=[{type:t.NgModule,args:[{declarations:[C],exports:[C]}]}],B);function B(){}e.NgxStripeModule=_,e.StripeCardComponent=C,e.StripeService=I,e.StripeFactoryService=O,e.StripeInstance=w,e.LazyStripeAPILoader=f,e.WindowRef=r,e.DocumentRef=p,e.isSourceData=h,e.STRIPE_PUBLISHABLE_KEY=l,e.STRIPE_OPTIONS=y,e.isBankAccount=m,e.isBankAccountData=v,e.isPii=b,e.isPiiData=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-stripe.umd.min.js.map